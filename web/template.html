<!DOCTYPE html>
<html>

<head>
	<title>Ripped Civitai Images</title>
	<link rel="stylesheet" type="text/css" href="/web/main.css">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body>
	<div class="container">
		{% for item in data %}
		<div class="img-container" id="container-{{ loop.index }}">
			<img class="lazy" data-src="/out/{{ item.image }}" alt="Image" loading="lazy"
				onclick="toggleShow('data-{{ loop.index }}', 'container-{{ loop.index }}')">
			<!-- {{ item.data|e }} -->
			<div class="json-data" id="data-{{ loop.index }}" style="display: none;">
				<span class="data-label">Prompt:</span>
				<code class="data-value cursor" id="code-prompt-{{ loop.index }}" onclick="copyToClipboard('code-prompt-{{ loop.index }}')">{{ item.data.meta.prompt|e }}</code>
				<span class="data-label">Negative:</span>
				<code class="data-value cursor" id="code-negative-{{ loop.index }}" onclick="copyToClipboard('code-negative-{{ loop.index }}')">{{ item.data.meta.negativePrompt|e }}</code>
				<span class="data-label">NSFW Level:</span>
				<code class="data-value">{{ item.data.nsfwLevel }}</code>
				<span class="data-label">Size:</span>
				<code class="data-value">{{ item.data.meta.Size }}</code>
				<span class="data-label">Model:</span>
				<code class="data-value">{{ item.data.meta.Model }}</code>
				<span class="data-label">Sampler:</span>
				<code class="data-value">{{ item.data.meta.sampler }}</code>
				<span class="data-label">CFG Scale:</span>
				<code class="data-value">{{ item.data.meta.cfgScale }}</code>
				<span class="data-label">Seed:</span>
				<code class="data-value">{{ item.data.meta.seed }}</code>
				<span class="data-label">Link:</span>
				<a class="data-value" href="https://civitai.com/images/{{ item.data.id }}">https://civitai.com/images/{{
					item.data.id }}</a>
			</div>
		</div>
		{% endfor %}
	</div>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			var lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));
			if ("IntersectionObserver" in window) {
				let lazyImageObserver = new IntersectionObserver(function (entries, observer) {
					entries.forEach(function (entry) {
						if (entry.isIntersecting) {
							let lazyImage = entry.target;
							lazyImage.src = lazyImage.dataset.src;
							lazyImage.classList.remove("lazy");
							lazyImageObserver.unobserve(lazyImage);

							// Load JSON data when the image comes into view
							var jsonDataElement = $(lazyImage).next('.json-data');
							$.getJSON(jsonDataElement.data('json'), function (data) {
								jsonDataElement.text(JSON.stringify(data, null, 2));
							});
						}
					});
				});

				lazyImages.forEach(function (lazyImage) {
					lazyImageObserver.observe(lazyImage);
				});
			}
		});
	</script>
	<script>
		function toggleShow(dataId, containerId) {
			var x = document.getElementById(dataId);
			var container = document.getElementById(containerId);
			if (x.style.display === "none") {
				x.style.display = "grid";
				container.classList.add('full-width');
			} else {
				x.style.display = "none";
				container.classList.remove('full-width');
			}
			container.scrollIntoView({ behavior: "smooth" });
		}
	</script>
	<script>
		function copyToClipboard(elementId) {
			var text = document.getElementById(elementId).innerText;
			var textarea = document.createElement("textarea");
			textarea.value = text;
			document.body.appendChild(textarea);
			textarea.select();
			document.execCommand("copy");
			document.body.removeChild(textarea);
			alert("Copied to clipboard!");
		}
	</script>
</body>

</html>
